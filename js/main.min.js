(function(o,A){var p=A.body,h=A.querySelector.bind(A),q=A.querySelectorAll.bind(A),u=h("html"),s=h("#gotop"),a=h("#menu"),x=h("#header"),v=h("#mask"),t=h("#menu-toggle"),n=h("#menu-off"),g=h("#loading"),k=o.requestAnimationFrame,r=200/(1000/60),y=Array.prototype.forEach,m=("ontouchstart" in o&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent))?"touchstart":"click",B=/micromessenger/i.test(navigator.userAgent),e=function(){},l=function(w){var d=w.offsetLeft,D=w.offsetTop;if(w.offsetParent){var C=arguments.callee(w.offsetParent);d+=C.x;D+=C.y}return{x:d,y:D}},z=function(){return A.documentElement.scrollTop||A.body.scrollTop};var b={goTop:function(d){var C=z();var w=arguments.length>2?arguments[1]:Math.abs(C-d)/r;if(C&&C>d){o.scrollTo(0,Math.max(C-w,0));k(arguments.callee.bind(this,d,w))}else{if(d&&C<d){o.scrollTo(0,Math.min(C+w,d));k(arguments.callee.bind(this,d,w))}else{this.toc.actived(d)}}},toggleGotop:function(d){if(d>o.innerHeight/2){s.classList.add("in")}else{s.classList.remove("in")}},toggleMenu:function(w){var d=h("#main");if(w){a.classList.remove("hide");if(o.innerWidth<1241){v.classList.add("in");a.classList.add("show");if(B){var C=z();d.classList.add("lock");d.scrollTop=C}else{u.classList.add("lock")}}}else{a.classList.remove("show");v.classList.remove("in");if(B){var C=d.scrollTop;d.classList.remove("lock")}else{u.classList.remove("lock")}}},fixedHeader:function(d){if(d>x.clientHeight){x.classList.add("fixed")}else{x.classList.remove("fixed")}},toc:(function(){var G=h("#post-toc");if(!G||!G.children.length){return{fixed:e,actived:e}}var E=h(".post-header").clientHeight,C=x.clientHeight,D=h("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");G.querySelector('a[href="#'+D[0].id+'"]').parentNode.classList.add("active");var F=G.querySelectorAll(".post-toc-child");for(i=0,len=F.length;i<len;i++){F[i].classList.add("post-toc-shrink")}var w=G.querySelector('a[href="#'+D[0].id+'"]').nextElementSibling;if(w){w.classList.add("post-toc-expand");w.classList.remove("post-toc-shrink")}G.classList.remove("post-toc-shrink");var d=function(K,I){K.classList.remove("active");I.classList.add("active");var H=I.parentElement.querySelectorAll(".post-toc-child");for(j=0,len1=H.length;j<len1;j++){H[j].classList.remove("post-toc-expand");H[j].classList.add("post-toc-shrink")}var J=I.querySelector(".post-toc-child");if(J){J.classList.remove("post-toc-shrink");J.classList.add("post-toc-expand")}};return{fixed:function(H){H>=E-C?G.classList.add("fixed"):G.classList.remove("fixed")},actived:function(J){for(i=0,len=D.length;i<len;i++){if(J>l(D[i]).y-C-5){var I=G.querySelector("li.active");var H=G.querySelector('a[href="#'+D[i].id+'"]').parentNode;d(I,H)}}if(J<l(D[0]).y){d(G.querySelector("li.active"),G.querySelector('a[href="#'+D[0].id+'"]').parentNode)}}}})(),hideOnMask:[],modal:function(d){this.$modal=h(d);this.$off=this.$modal.querySelector(".close");var w=this;this.show=function(){v.classList.add("in");w.$modal.classList.add("ready");setTimeout(function(){w.$modal.classList.add("in")},0)};this.onHide=e;this.hide=function(){w.onHide();v.classList.remove("in");w.$modal.classList.remove("in");setTimeout(function(){w.$modal.classList.remove("ready")},300)};this.toggle=function(){return w.$modal.classList.contains("in")?w.hide():w.show()};b.hideOnMask.push(this.hide);this.$off&&this.$off.addEventListener(m,this.hide)},share:function(){var w=h("#pageShare"),C=h("#shareFab");var d=new this.modal("#globalShare");h("#menuShare").addEventListener(m,d.toggle);if(C){C.addEventListener(m,function(){w.classList.toggle("in")},false);A.addEventListener(m,function(E){!C.contains(E.target)&&w.classList.remove("in")},false)}var D=new this.modal("#wxShare");D.onHide=d.hide;y.call(q(".wxFab"),function(E){E.addEventListener(m,D.toggle)})},search:function(){var d=h("#search-wrap");function w(){d.classList.toggle("in")}h("#search").addEventListener(m,w)},reward:function(){var w=new this.modal("#reward");h("#rewardBtn").addEventListener(m,w.toggle);var C=h("#rewardToggle");var d=h("#rewardCode");if(C){C.addEventListener("change",function(){d.src=this.checked?this.dataset.alipay:this.dataset.wechat})}},waterfall:function(){if(o.innerWidth<760){return}y.call(q(".waterfall"),function(w){var C=w.querySelectorAll(".waterfall-item");var d=[0,0];y.call(C,function(E){var D=d[0]<=d[1]?0:1;E.style.cssText="top:"+d[D]+"px;left:"+(D>0?"50%":0);d[D]+=E.offsetHeight});w.style.height=Math.max(d[0],d[1])+"px";w.classList.add("in")})},tabBar:function(d){d.parentNode.parentNode.classList.toggle("expand")},page:(function(){var d=q(".fade, .fade-scale");var w=false;return{loaded:function(){y.call(d,function(C){C.classList.add("in")});w=true},unload:function(){y.call(d,function(C){C.classList.remove("in")});w=false},visible:w}})(),lightbox:(function(){function d(D){this.$img=D.querySelector("img");this.$overlay=D.querySelector("overlay");this.margin=40;this.title=this.$img.title||this.$img.alt||"";this.isZoom=false;var G,w,E,C,F;this.calcRect=function(){C=p.clientWidth;F=p.clientHeight;var L=F-this.margin*2;var K=G;var P=w;var N=this.margin;var J=0;var I=K>C?C/K:1;var M=P>L?L/P:1;var O=Math.min(I,M);K=K*O;P=P*O;return{w:K,h:P,t:(F-P)/2-E.top,l:(C-K)/2-E.left+this.$img.offsetLeft}};this.setImgRect=function(I){this.$img.style.cssText="width: "+I.w+"px; max-width: "+I.w+"px; height:"+I.h+"px; top: "+I.t+"px; left: "+I.l+"px"};this.setFrom=function(){this.setImgRect({w:E.width,h:E.height,t:0,l:(D.offsetWidth-E.width)/2})};this.setTo=function(){this.setImgRect(this.calcRect())};this.addTitle=function(){if(!this.title){return}this.$caption=A.createElement("div");this.$caption.innerHTML=this.title;this.$caption.className="overlay-title";D.appendChild(this.$caption)};this.removeTitle=function(){this.$caption&&D.removeChild(this.$caption)};var H=this;this.zoomIn=function(){G=this.$img.naturalWidth||this.$img.width;w=this.$img.naturalHeight||this.$img.height;E=this.$img.getBoundingClientRect();D.style.height=E.height+"px";D.classList.add("ready");this.setFrom();this.addTitle();this.$img.classList.add("zoom-in");setTimeout(function(){D.classList.add("active");H.setTo();H.isZoom=true},0)};this.zoomOut=function(){this.isZoom=false;D.classList.remove("active");this.$img.classList.add("zoom-in");this.setFrom();setTimeout(function(){H.$img.classList.remove("zoom-in");H.$img.style.cssText="";H.removeTitle();D.classList.remove("ready");D.removeAttribute("style")},300)};D.addEventListener("click",function(I){H.isZoom?H.zoomOut():I.target.tagName==="IMG"&&H.zoomIn()});A.addEventListener("scroll",function(){H.isZoom&&H.zoomOut()});o.addEventListener("resize",function(){H.isZoom&&H.zoomOut()})}y.call(q(".img-lightbox"),function(w){new d(w)})})(),loadScript:function(d){d.forEach(function(C){var w=A.createElement("script");w.src=C;w.async=true;p.appendChild(w)})}};o.addEventListener("load",function(){g.classList.remove("active");b.page.loaded();o.lazyScripts&&o.lazyScripts.length&&b.loadScript(o.lazyScripts)});o.addEventListener("DOMContentLoaded",function(){b.waterfall();var d=z();b.toc.fixed(d);b.toc.actived(d);b.page.loaded()});var f=false;var c=h('a[href^="mailto"]');if(c){c.addEventListener(m,function(){f=true})}o.addEventListener("beforeunload",function(d){if(!f){b.page.unload()}else{f=false}});o.addEventListener("pageshow",function(){!b.page.visible&&b.page.loaded()});o.addEventListener("resize",function(){o.BLOG.even=m="ontouchstart" in o?"touchstart":"click";b.toggleMenu();b.waterfall()});s.addEventListener(m,function(){k(b.goTop.bind(b,0))},false);t.addEventListener(m,function(d){b.toggleMenu(true);d.preventDefault()},false);n.addEventListener(m,function(){a.classList.add("hide")},false);v.addEventListener(m,function(d){b.toggleMenu();b.hideOnMask.forEach(function(w){w()});d.preventDefault()},false);A.addEventListener("scroll",function(){var d=z();b.toggleGotop(d);b.fixedHeader(d);b.toc.fixed(d);b.toc.actived(d)},false);if(o.BLOG.SHARE){b.share()}if(o.BLOG.REWARD){b.reward()}b.noop=e;b.even=m;b.$=h;b.$$=q;Object.keys(b).reduce(function(d,w){d[w]=b[w];return d},o.BLOG);if(o.Waves){Waves.init();Waves.attach(".global-share li",["waves-block"]);Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])}else{console.error("Waves loading failed.")}})(window,document);
